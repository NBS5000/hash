<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/css/index.css">

    <title>Document</title>
</head>
<body>
        <form id="hashForm">
            <div id="fileUploadWrapper">
                <input 
                    type="file" 
                    id="file"
                    accept=".csv"    
                    placeholder="File"
                />
                <label for="file" id="label_file">Select a file...</label>
                <p id="fileName"></p>
            </div>
        </form>
        <br/>
        <div id="headerList"></div>
        <div id="downloadSection">
            <input
                type="button"
                id="action"
                value="Download"
            />
            <span id="downloadTick">âœ”</span>
            <br/>
            <p id="hashFileName"></p>
        </div>
    <script src="./assets/js/colSelect.js"></script>
    <script src="./assets/js/hash.js"></script>
    <script src="./assets/js/validate.js"></script>
    <script>
        /** 
         * ! this function adds listener to checkboxes 
         * ! generated by colSelect()
         **/
        const upload = document.getElementById("file");
        upload.addEventListener('change',async function (){
            //const valid = validate();

            validate().then(
                async () => {
                    await colSelect().then(
                        ()=> {
                            const chkBoxes = document.getElementsByClassName("headerChk");
                            for (var i = 0; i < chkBoxes.length; i++) {
                                chkBoxes[i].addEventListener('click', hideShowButton);
                            }
                            const hashBtn = document.getElementById("btn_headerForm");
                            hashBtn.addEventListener('click',startHash)
                        }
                    )
                }
            )
        });


    </script>
    <script>
        /** 
         * ! this function shows/hides hash button based on 
         * ! checked checkboxes generated by colSelect()
         **/
        let show = 0;
        let cols = [];
        function hideShowButton(e){
            const btn = document.getElementById("btn_headerForm");
            e.target.checked ? show++ : show-- ;
            e.target.checked ? cols.push(e.target.value) : cols.shift(e.target.value) ;
            show ? btn.style.display="initial" : btn.style.display="none";
        }
        /** 
         * ! this function starts the hash process
         **/
        async function startHash(){
            await hashData(cols).then(()=>{
                console.log("Hash complete");
            }).catch(() => {
                console.log("Hash cancelled");
            });
            document.getElementById("fileName").innerHTML = "";
            document.getElementById("headerList").innerHTML = "";
            document.getElementById("hashForm").reset();
        }
    </script>
</body>
</html>